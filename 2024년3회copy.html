<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>수직 북마크 재배열</title>
    <!-- Tailwind CSS를 로드하여 쉬운 스타일링을 할 수 있게 합니다. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* 드래그되는 요소를 위한 스타일 */
      .dragging {
        opacity: 0.4;
      }
      /* 드롭 존에 들어갈 때의 시각적 피드백 */
      .drop-zone-highlight {
        border-color: #6366f1; /* 보라색 테두리 */
        background-color: #eef2ff; /* 연한 보라색 배경 */
      }
      /* 커스텀 메시지 상자 스타일 */
      .custom-message-box {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #333;
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.5s ease-in-out;
      }
      .custom-message-box.show {
        opacity: 1;
      }
    </style>
  </head>
  <body
    class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4 font-sans"
  >
    <main class="w-full max-w-2xl space-y-8">
      <h1 class="text-3xl font-bold text-center text-gray-800">
        나만의 북마크를 재배열하세요
      </h1>

      <!-- 하나의 통합된 드롭 존: 모든 카드가 여기에 있습니다. -->
      <div
        id="bookmark-list"
        class="drop-zone w-full bg-white p-6 rounded-lg shadow-lg border-2 border-dashed border-gray-300 transition-all duration-300 flex flex-col gap-4"
      >
        <h2 class="text-xl font-semibold text-gray-700">
          여기에 드롭하여 순서를 바꿀 수 있습니다.
        </h2>

        <!-- 드래그 가능한 첫 번째 카드 -->
        <div
          id="drag-item-1"
          class="draggable-item bg-white rounded-lg shadow-md p-4 cursor-pointer transition-all duration-300 border border-gray-200 hover:border-indigo-500"
          draggable="true"
        >
          <table class="w-full border-collapse">
            <tbody>
              <tr>
                <td class="p-2 w-1/3">
                  <!-- Placeholder 이미지 사용 -->
                  <img
                    src="https://placehold.co/200x150/E0E7FF/4338CA?text=비상전원"
                    alt="비상전원 종류별 적용 설비"
                    class="rounded-lg w-full"
                  />
                </td>
                <td class="p-2 w-2/3">
                  <textarea
                    class="w-full h-32 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm"
                    placeholder="이 이미지에 대한 설명을 작성하세요..."
                  ></textarea>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- 드래그 가능한 두 번째 카드 -->
        <div
          id="drag-item-2"
          class="draggable-item bg-white rounded-lg shadow-md p-4 cursor-pointer transition-all duration-300 border border-gray-200 hover:border-indigo-500"
          draggable="true"
        >
          <table class="w-full border-collapse">
            <tbody>
              <tr>
                <td class="p-2 w-1/3">
                  <!-- Placeholder 이미지 사용 -->
                  <img
                    src="https://placehold.co/200x150/D1C4E9/673AB7?text=옥내소화전설비"
                    alt="옥내소화전설비 비상전원 설치기준"
                    class="rounded-lg w-full"
                  />
                </td>
                <td class="p-2 w-2/3">
                  <textarea
                    class="w-full h-32 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm"
                    placeholder="이 이미지에 대한 설명을 작성하세요..."
                  ></textarea>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- 드래그 가능한 세 번째 카드 -->
        <div
          id="drag-item-3"
          class="draggable-item bg-white rounded-lg shadow-md p-4 cursor-pointer transition-all duration-300 border border-gray-200 hover:border-indigo-500"
          draggable="true"
        >
          <table class="w-full border-collapse">
            <tbody>
              <tr>
                <td class="p-2 w-1/3">
                  <!-- Placeholder 이미지 사용 -->
                  <img
                    src="https://placehold.co/200x150/C8E6C9/4CAF50?text=2018년4회"
                    alt="2018년4회 이미지"
                    class="rounded-lg w-full"
                  />
                </td>
                <td class="p-2 w-2/3">
                  <textarea
                    class="w-full h-32 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm"
                    placeholder="이 이미지에 대한 설명을 작성하세요..."
                  ></textarea>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- 드래그 가능한 네 번째 카드 -->
        <div
          id="drag-item-4"
          class="draggable-item bg-white rounded-lg shadow-md p-4 cursor-pointer transition-all duration-300 border border-gray-200 hover:border-indigo-500"
          draggable="true"
        >
          <table class="w-full border-collapse">
            <tbody>
              <tr>
                <td class="p-2 w-1/3">
                  <!-- Placeholder 이미지 사용 -->
                  <img
                    src="https://placehold.co/200x150/FFECB3/FF9800?text=2014년4회"
                    alt="2014년4회 이미지"
                    class="rounded-lg w-full"
                  />
                </td>
                <td class="p-2 w-2/3">
                  <textarea
                    class="w-full h-32 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm"
                    placeholder="이 이미지에 대한 설명을 작성하세요..."
                  ></textarea>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- 드래그 가능한 다섯 번째 카드 -->
        <div
          id="drag-item-5"
          class="draggable-item bg-white rounded-lg shadow-md p-4 cursor-pointer transition-all duration-300 border border-gray-200 hover:border-indigo-500"
          draggable="true"
        >
          <table class="w-full border-collapse">
            <tbody>
              <tr>
                <td class="p-2 w-1/3">
                  <!-- Placeholder 이미지 사용 -->
                  <img
                    src="https://placehold.co/200x150/CFD8DC/607D8B?text=2012년4회"
                    alt="2012년4회 이미지"
                    class="rounded-lg w-full"
                  />
                </td>
                <td class="p-2 w-2/3">
                  <textarea
                    class="w-full h-32 p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm"
                    placeholder="이 이미지에 대한 설명을 작성하세요..."
                  ></textarea>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- 복사/삭제 기능 영역 -->
      <div
        class="w-full bg-white p-6 rounded-lg shadow-lg border border-gray-200 flex flex-col gap-4"
      >
        <h2 class="text-xl font-semibold text-gray-700">작성 내용 요약</h2>
        <textarea
          id="srcList"
          class="w-full h-48 p-4 border border-gray-300 rounded-lg bg-gray-50 focus:outline-none text-sm"
          readonly
        ></textarea>
        <div class="flex gap-4">
          <button
            onclick="copyToClipboard()"
            class="flex-1 bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-indigo-600 transition-colors"
          >
            복사
          </button>
          <button
            onclick="saveToFile()"
            class="flex-1 bg-green-500 text-white font-bold py-2 px-4 rounded-lg shadow-md hover:bg-green-600 transition-colors"
          >
            저장
          </button>
          <button
            onclick="clearAll()"
            class="flex-1 bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md hover:bg-gray-400 transition-colors"
          >
            삭제
          </button>
        </div>
      </div>
    </main>

    <!-- 커스텀 메시지 상자 -->
    <div id="message-box" class="custom-message-box"></div>

    <script>
      // DOMContentLoaded 이벤트 리스너를 추가하여 스크립트가 HTML 요소가 모두 로드된 후 실행되도록 합니다.
      document.addEventListener("DOMContentLoaded", () => {
        // 드래그 가능한 모든 요소를 가져옵니다.
        const draggables = document.querySelectorAll(".draggable-item");
        // 모든 드롭 존을 가져옵니다.
        const dropZones = document.querySelectorAll(".drop-zone");

        // 각 드래그 가능 요소에 대한 이벤트 리스너를 설정합니다.
        draggables.forEach((item) => {
          // 드래그가 시작될 때
          item.addEventListener("dragstart", (e) => {
            // 요소를 'dragging' 상태로 표시합니다.
            setTimeout(() => e.target.classList.add("dragging"), 0);
            // 드래그하는 요소의 ID를 dataTransfer 객체에 저장합니다.
            e.dataTransfer.setData("text/plain", e.target.id);
          });

          // 드래그가 끝날 때
          item.addEventListener("dragend", (e) => {
            // 'dragging' 상태를 제거합니다.
            e.target.classList.remove("dragging");
          });

          // textarea의 내용이 변경될 때마다 updateSrcList 함수를 호출합니다.
          const textarea = item.querySelector("textarea");
          if (textarea) {
            textarea.addEventListener("input", updateSrcList);
          }
        });

        // 각 드롭 존에 대한 이벤트 리스너를 설정합니다.
        dropZones.forEach((zone) => {
          // 드롭 가능한 영역 위로 드래그할 때
          zone.addEventListener("dragover", (e) => {
            // 기본 동작을 방지하여 드롭을 허용합니다.
            e.preventDefault();
            // 드롭 존에 강조 표시를 합니다.
            zone.classList.add("drop-zone-highlight");
          });

          // 드롭 가능한 영역을 떠날 때
          zone.addEventListener("dragleave", (e) => {
            // 강조 표시를 제거합니다.
            zone.classList.remove("drop-zone-highlight");
          });

          // 요소가 드롭 존에 드롭될 때
          zone.addEventListener("drop", (e) => {
            // 기본 동작을 방지합니다.
            e.preventDefault();
            // 강조 표시를 제거합니다.
            zone.classList.remove("drop-zone-highlight");

            // dataTransfer에서 저장된 요소의 ID를 가져옵니다.
            const draggedId = e.dataTransfer.getData("text/plain");
            const draggedElement = document.getElementById(draggedId);

            if (draggedElement) {
              // 드롭된 위치를 찾기 위해 드롭된 요소의 상위 요소를 찾습니다.
              const dropTarget = e.target.closest(".drop-zone");

              // 드롭 대상이 유효한지 확인합니다.
              if (dropTarget) {
                // 드롭된 요소의 뒤에 드롭될 위치를 찾습니다.
                const afterElement = getDragAfterElement(dropTarget, e.clientY);

                if (afterElement == null) {
                  // 드롭 존의 끝에 요소를 추가합니다.
                  dropTarget.appendChild(draggedElement);
                } else {
                  // 특정 요소 앞에 요소를 삽입하여 재배열을 허용합니다.
                  dropTarget.insertBefore(draggedElement, afterElement);
                }
              }
            }
            updateSrcList(); // 드롭 후 내용을 업데이트합니다.
          });
        });

        // 드롭된 위치를 기준으로 삽입할 위치를 결정하는 도우미 함수입니다.
        function getDragAfterElement(container, y) {
          // 현재 드래그되는 요소를 제외한 컨테이너 내의 모든 드래그 가능한 요소
          const draggableElements = [
            ...container.querySelectorAll(".draggable-item:not(.dragging)"),
          ];

          // 마우스 커서의 Y 좌표에 가장 가까운 요소를 찾습니다.
          return draggableElements.reduce(
            (closest, child) => {
              const box = child.getBoundingClientRect();
              const offset = y - box.top - box.height / 2;
              if (offset < 0 && offset > closest.offset) {
                return { offset: offset, element: child };
              } else {
                return closest;
              }
            },
            { offset: Number.NEGATIVE_INFINITY }
          ).element;
        }

        // 모든 텍스트 영역의 내용을 읽어 요약 텍스트 영역에 업데이트하는 함수입니다.
        function updateSrcList() {
          const allItems = document.querySelectorAll(".draggable-item");
          let combinedContent = "";
          allItems.forEach((item) => {
            const image = item.querySelector("img");
            const contentTextarea = item.querySelector("textarea");
            if (image && contentTextarea) {
              const src = image.getAttribute("src");
              const text = contentTextarea.value.trim();
              if (text !== "") {
                combinedContent += `주소: ${src}\n내용: ${text}\n\n`;
              }
            }
          });
          document.getElementById("srcList").value = combinedContent;
        }

        // 커스텀 메시지 상자를 표시하는 함수
        function showMessage(message) {
          const messageBox = document.getElementById("message-box");
          messageBox.textContent = message;
          messageBox.classList.add("show");
          setTimeout(() => {
            messageBox.classList.remove("show");
          }, 3000); // 3초 후에 메시지 상자를 숨깁니다.
        }

        // 클립보드에 내용을 복사하는 함수입니다.
        window.copyToClipboard = () => {
          const textarea = document.getElementById("srcList");
          textarea.select();
          document.execCommand("copy");
          showMessage("주소와 내용이 클립보드에 복사되었습니다.");
        };

        // 모든 내용을 초기화하는 함수입니다.
        window.clearAll = () => {
          const allTextareas = document.querySelectorAll("textarea");
          allTextareas.forEach((textarea) => {
            if (textarea.id !== "srcList") {
              textarea.value = "";
            }
          });
          document.getElementById("srcList").value = "";
          showMessage("모든 내용이 초기화되었습니다.");
        };

        // 텍스트를 파일로 저장하는 함수입니다.
        window.saveToFile = () => {
          const content = document.getElementById("srcList").value;
          if (content.trim() === "") {
            showMessage("저장할 내용이 없습니다.");
            return;
          }
          const blob = new Blob([content], { type: "text/plain" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "bookmarks.txt";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
          showMessage("파일이 저장되었습니다.");
        };

        // 초기 로드 시 플레이스홀더 텍스트를 설정합니다.
        updateSrcList();
      });
    </script>
  </body>
</html>
